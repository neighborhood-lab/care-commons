# Development Guide

## Quick Start

1. **Clone the repository**
   ```bash
   git clone https://github.com/neighborhood-lab/care-commons.git
   cd care-commons
   ```

2. **Run setup script**
   ```bash
   npm run dev:setup
   ```

3. **Start development servers**
   ```bash
   npm run dev
   ```

4. **Open browser**
   - Web app: http://localhost:5173
   - API: http://localhost:3000
   - API docs: http://localhost:3000/api-docs
   - Health check: http://localhost:3000/health

## Using Docker (Optional)

If you prefer using Docker for PostgreSQL and Redis:

```bash
npm run dev:docker
```

To stop Docker services:

```bash
npm run dev:docker:down
```

## Default Credentials

- **Admin**: admin@example.com / password123
- **Coordinator**: coordinator@example.com / password123
- **Caregiver**: caregiver@example.com / password123

## Common Tasks

- **Reset database**: `npm run dev:reset`
- **Run migrations**: `npm run db:migrate`
- **Seed demo data**: `npm run db:seed:demo`
- **Run tests**: `npm test`
- **Type check**: `npm run typecheck`
- **Lint**: `npm run lint`
- **Clean build**: `npm run dev:clean`

## Troubleshooting

### Database connection error

If you see "connection refused" errors:
1. Check PostgreSQL is running: `pg_isready`
2. Check database exists: `psql -l | grep care_commons`
3. Check DB_* variables in `.env`

### Port already in use

If port 3000 or 5173 is in use:
1. Find process: `lsof -i :3000`
2. Kill process: `kill -9 <PID>`

### Build errors

Clean and rebuild:
```bash
npm run dev:clean
npm install
npm run build
```

### PostgreSQL installation

**macOS**:
```bash
brew install postgresql@14
brew services start postgresql@14
```

**Ubuntu**:
```bash
sudo apt update
sudo apt install postgresql-14
sudo systemctl start postgresql
```

**Windows**:
Download from https://www.postgresql.org/download/windows/

**Using Docker** (all platforms):
```bash
npm run dev:docker
```

## VS Code Setup

### Recommended Extensions

- ESLint
- Prettier - Code formatter
- TypeScript and JavaScript Language Features
- Playwright Test for VSCode (for E2E tests)

### Running Development Servers from VS Code

**Using Tasks**:
- Press `Cmd+Shift+B` (Mac) or `Ctrl+Shift+B` (Windows/Linux)
- Select "Start Development Servers"

**Using Debug**:
- Press `F5` to debug the API server
- Select "Debug API Server" or "Debug Web App"

## Project Structure

```
care-commons/
├── packages/
│   ├── app/          # Backend API (Express)
│   ├── core/         # Shared database & business logic
│   ├── web/          # Frontend web app (React)
│   └── mobile/       # Mobile app (React Native)
├── verticals/        # Vertical-specific implementations
├── showcase/         # Demo & showcase app
├── docs/            # Documentation
├── scripts/         # Development & deployment scripts
└── e2e/             # End-to-end tests (Playwright)
```

## Database Management

### Migrations

Create a new migration:
```bash
cd packages/core
npm run db:migrate:make migration_name
```

Run migrations:
```bash
npm run db:migrate
```

Rollback last migration:
```bash
npm run db:migrate:rollback
```

Check migration status:
```bash
npm run db:migrate:status
```

### Seeding

Seed minimal data (for tests):
```bash
npm run db:seed
```

Seed demo data (for development):
```bash
npm run db:seed:demo
```

Reset database with demo data:
```bash
npm run dev:reset
```

## Testing

### Unit Tests

Run all unit tests:
```bash
npm test
```

Run with coverage:
```bash
npm run test:coverage
```

### E2E Tests

Run all E2E tests:
```bash
npm run test:e2e
```

Run in UI mode (interactive):
```bash
npm run test:e2e:ui
```

Run in debug mode:
```bash
npm run test:e2e:debug
```

Run specific browser:
```bash
npm run test:e2e:chromium
npm run test:e2e:firefox
npm run test:e2e:webkit
```

## Code Quality

### Linting

```bash
npm run lint
```

### Type Checking

```bash
npm run typecheck
```

## Development Workflow

1. Create a new branch from `main`
2. Make your changes
3. Run tests: `npm test`
4. Run type check: `npm run typecheck`
5. Run linter: `npm run lint`
6. Commit your changes
7. Push and create a pull request

## Environment Variables

Key environment variables for development:

```bash
# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=care_commons
DB_USER=postgres
DB_PASSWORD=postgres

# Application
NODE_ENV=development
PORT=3000

# CORS
CORS_ORIGIN=*

# Security (auto-generated by dev:setup)
JWT_SECRET=<generated>
JWT_REFRESH_SECRET=<generated>
SESSION_SECRET=<generated>
ENCRYPTION_KEY=<generated>

# Development
MOCK_USER_PASSWORD=<generated>
```

See `.env.example` for all available options.

## Additional Resources

- [API Documentation](http://localhost:3000/api-docs) (when running locally)
- [Architecture Overview](../README.md)
- [Database Schema](./QUERY_OPTIMIZATION.md)
- [Compliance Documentation](./compliance/)
