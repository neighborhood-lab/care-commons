**DO NOT EDIT THIS FILE UNLESS YOU WERE EXPLICITLY INSTRUCTED IN YOUR PROMPT TO READ THE `input.md` FILE IN THIS SAME DIRECTORY (`claude/layer-1/input.md`)**

---

# Care Commons - Central Planner Vision & State
*Last Updated: 2025-11-06*

## EXECUTIVE SUMMARY

**Care Commons** is a self-hostable, modular home healthcare platform serving agencies managing in-home care. Our mission is to provide agencies with production-ready tools that handle compliance, scheduling, billing, and family engagement while remaining lean, maintainable, and scalable.

**Current State**: Strong backend foundations (80-90% complete), partial frontend implementation, mobile foundation established. **Next Phase**: Complete service integrations, implement remaining frontend verticals, expand mobile app, and ensure production readiness.

---

## PRODUCT VISION

### Core Value Proposition
A **turnkey home healthcare platform** that agencies can self-host or deploy via Vercel in minutes, providing:
- âœ… Multi-state EVV compliance (TX, FL, OH, PA, GA, NC, AZ)
- âœ… Intelligent scheduling and shift matching
- âœ… Family engagement and transparency
- âœ… Complete billing and payroll workflows
- âœ… Offline-first mobile experience for caregivers
- âœ… Real-time analytics and compliance reporting

### Target Personas

1. **Administrators**: Need overview of operations, financial health, compliance status
2. **Coordinators**: Manage day-to-day scheduling, caregiver assignments, client needs
3. **Caregivers**: Complete visits, document care, track time via mobile app
4. **Family Members**: Monitor loved one's care, communicate with care team
5. **Clients/Patients**: Receive quality care with transparency

### Product Principles

1. **Real-World First**: Features must work end-to-end in production, not just demos
2. **Offline-First**: Mobile and web must work without connectivity, sync when online
3. **Compliance-Native**: EVV, HIPAA, state-specific rules baked into every feature
4. **Learnable by Discovery**: Showcase and demo environment teach users the platform
5. **Less is More**: Remove cruft aggressively, prefer 1 great way over 3 mediocre ways
6. **Developer Speed**: Tooling, architecture, and documentation optimize for rapid iteration

---

## ARCHITECTURE VISION

### Technology Philosophy

**Backend**: Node.js/TypeScript with Express, PostgreSQL with Knex migrations, JWT auth
**Frontend Web**: React 19 + Vite, Tailwind CSS, Zustand + React Query
**Frontend Mobile**: React Native + Expo, WatermelonDB (offline-first)
**Deployment**: Vercel serverless (default), self-hosted Docker (supported)

**Architectural Patterns**:
- **Monorepo**: Turborepo with package isolation and shared components
- **Vertical Slice**: Each vertical (billing, scheduling, etc.) is independently deployable
- **Event-Driven**: Visit lifecycle events trigger dependent systems
- **Provider Interfaces**: Service contracts enable mocking and testing

### Target Architecture State

```
care-commons/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ app/          # Express API server (thin routing layer)
â”‚   â”œâ”€â”€ core/         # Database, auth, types (shared primitives)
â”‚   â”œâ”€â”€ web/          # React web UI (responsive, offline-capable)
â”‚   â”œâ”€â”€ mobile/       # React Native app (offline-first, GPS-enabled)
â”‚   â””â”€â”€ shared-components/ # Platform-agnostic UI components
â”‚
â”œâ”€â”€ verticals/        # Independent feature modules
â”‚   â”œâ”€â”€ client-demographics/     # âœ… Complete
â”‚   â”œâ”€â”€ caregiver-staff/         # âœ… Complete
â”‚   â”œâ”€â”€ scheduling-visits/       # ğŸš§ Complete backend, needs service integration fixes
â”‚   â”œâ”€â”€ care-plans-tasks/        # ğŸš§ Backend complete, frontend needed
â”‚   â”œâ”€â”€ time-tracking-evv/       # ğŸš§ Complete, needs service integration fixes
â”‚   â”œâ”€â”€ family-engagement/       # ğŸš§ Backend complete, frontend needed
â”‚   â”œâ”€â”€ shift-matching/          # âœ… Complete
â”‚   â”œâ”€â”€ billing-invoicing/       # âœ… Production ready
â”‚   â”œâ”€â”€ payroll-processing/      # ğŸš§ Schema complete, logic/UI needed
â”‚   â”œâ”€â”€ analytics-reporting/     # ğŸš§ Complete backend, partial UI
â”‚   â””â”€â”€ quality-assurance-audits/# ğŸš§ Schema ready, implementation needed
â”‚
â””â”€â”€ showcase/         # Interactive demo app (critical for onboarding)
```

**Design System Goals**:
- Consistent Tailwind tokens across web and mobile
- Reusable form patterns (React Hook Form + Zod everywhere)
- Accessible components (WCAG AA minimum)
- Mobile-first responsive design

---

## CURRENT STATE ASSESSMENT

### What Works Well âœ…

1. **Database Schema**: Comprehensive, normalized, with audit trails and soft deletes
2. **Authentication**: JWT + refresh tokens, Google OAuth, password fallback
3. **EVV Compliance**: 7-state support with GPS, biometric, offline sync
4. **Shift Matching**: 8-dimensional scoring algorithm (production-ready)
5. **Billing**: Service-to-billable conversion, invoicing, rate schedules
6. **Offline Architecture**: WatermelonDB with sync protocol
7. **Documentation**: Extensive (50+ docs covering deployment, compliance, architecture)
8. **CI/CD**: GitHub Actions for test, build, deploy
9. **Monorepo Setup**: Turborepo with proper dependency management

### Critical Gaps ğŸš§

**Backend**:
1. **Mocked Service Integrations**: EVV and Scheduling services have placeholder data instead of real lookups
   - `packages/app/src/services/evv-service.ts` lines 60-92 (mocked client/caregiver data)
   - `verticals/scheduling-visits/src/services/schedule.service.ts` line 566-576 (placeholder addresses)
   - **Impact**: Features appear complete but won't work in production

2. **Provider Interface Implementation**: Contracts defined (`IVisitProvider`, `IClientProvider`, `ICaregiverProvider`) but not fully wired up across verticals

**Frontend Web**:
1. **Care Plans & Tasks**: Backend API complete, frontend UI needed
2. **Family Engagement**: Portal and messaging UI not implemented
3. **Payroll Processing**: UI for pay stubs, tax calculations needed
4. **Analytics Dashboard**: Partial implementation, needs completion

**Frontend Mobile**:
1. **Screen Implementations**: Foundation exists, but most screens are placeholders
   - `TodayVisitsScreen` is fully implemented (reference example)
   - Other screens need build-out following the same pattern

**DevEx & Speed**:
1. **Test Coverage**: Below 70% target in some packages
2. **API Documentation**: Incomplete for some verticals (needs OpenAPI/Swagger)
3. **Mobile Development**: Manual testing only, needs automation

---

## STRATEGIC PRIORITIES (NEXT 90 DAYS)

### Phase 1: Production Readiness (Weeks 1-4)
**Goal**: Ensure existing features work end-to-end in production

1. **Replace Mocked Service Integrations** âš¡ CRITICAL
   - Fix EVV service to use real client/caregiver providers
   - Fix scheduling service to use real address lookups
   - Wire up provider interfaces across verticals

2. **Complete Frontend for Core Verticals**
   - Implement Care Plans UI (backend ready)
   - Implement Family Engagement portal (backend ready)

3. **Mobile App Critical Path**
   - Complete visit workflow screens (start visit, document care, end visit)
   - Implement GPS check-in/check-out
   - Test offline sync in real-world conditions

4. **Performance & Load Testing**
   - Establish baseline metrics (response times, throughput)
   - Load test with 50+ concurrent users
   - Optimize slow queries

### Phase 2: Feature Completeness (Weeks 5-8)
**Goal**: Ship remaining verticals to production

1. **Payroll Processing**
   - Implement tax calculation service
   - Build pay stub generation UI
   - Test with multi-state tax rules

2. **Analytics Dashboard**
   - Complete admin dashboard UI
   - Complete coordinator dashboard UI
   - Add export functionality (PDF, Excel, CSV)

3. **Quality Assurance Module**
   - Implement audit workflows
   - Build QA dashboard
   - Integrate with care plans

### Phase 3: Polish & Developer Experience (Weeks 9-12)
**Goal**: Make platform learnable and maintainable

1. **Showcase Enhancement**
   - Add guided tours for each vertical
   - Create realistic multi-persona scenarios
   - Add video walkthroughs

2. **Developer Tools**
   - Generate OpenAPI documentation
   - Improve local dev setup (one-command start)
   - Expand E2E test coverage

3. **Refactoring & Cruft Removal**
   - Consolidate duplicate code
   - Remove unused dependencies
   - Simplify configuration files

---

## QUALITY STANDARDS

### Code Quality
- âœ… TypeScript strict mode enforced
- âœ… ESLint with no warnings allowed
- âœ… 70% minimum test coverage
- âœ… All tests pass before merge
- âœ… SQL linting enabled

### UX Quality
- âœ… Mobile-first responsive design
- âœ… Accessible (WCAG AA)
- âœ… Loading states for all async operations
- âœ… Error messages are helpful (not technical)
- âœ… Forms validate on blur and submit

### Documentation Quality
- âœ… Every vertical has README with examples
- âœ… API routes documented with request/response examples
- âœ… Database migrations have rollback instructions
- âœ… Deployment runbooks are step-by-step
- âœ… Compliance docs reference specific state regulations

---

## DECISION LOG

### Technology Choices

1. **Why Turborepo over Nx?** â†’ Simpler, faster, less configuration
2. **Why Knex over Prisma?** â†’ More control over migrations, better for complex queries
3. **Why WatermelonDB?** â†’ Best offline-first solution for React Native with mature sync
4. **Why Vercel over AWS?** â†’ Simpler deployment, better DX, adequate for target scale
5. **Why Zustand over Redux?** â†’ Less boilerplate, easier to learn, sufficient for needs

### Architecture Decisions

1. **Monorepo over Polyrepo** â†’ Easier to refactor across packages, shared tooling
2. **Vertical Slice over Layered** â†’ Faster feature development, clearer ownership
3. **Provider Interfaces** â†’ Enable testing without database, enable multiple implementations
4. **Offline-First** â†’ Critical for caregivers in homes without WiFi
5. **JWT over Sessions** â†’ Stateless, works with serverless, scales horizontally

---

## ANTI-PATTERNS TO AVOID

1. âŒ **Feature Bloat**: Don't add features without clear persona need
2. âŒ **Premature Optimization**: Profile before optimizing
3. âŒ **Over-Abstraction**: Prefer duplication over wrong abstraction
4. âŒ **Test Theater**: Tests that don't catch real bugs waste time
5. âŒ **Documentation Debt**: Undocumented code is technical debt
6. âŒ **Magic Numbers**: Always use named constants
7. âŒ **Anemic Models**: Business logic should be in service layer, not controllers

---

## SUCCESS METRICS

### Product Metrics
- [ ] 3+ agencies using in production
- [ ] 100+ caregivers using mobile app daily
- [ ] <5% EVV visit rejection rate
- [ ] 99.5%+ mobile offline sync success rate

### Developer Metrics
- [ ] New developer productive in <1 day
- [ ] Feature development time reduced 30% vs initial baseline
- [ ] 0 P0 production bugs per month
- [ ] <10 minutes from code push to production deploy

### Business Metrics
- [ ] Agencies can self-onboard in <2 hours
- [ ] 90%+ feature adoption rate (features used by 90%+ of users)
- [ ] Showcase converts 50%+ of evaluators to trial users

---

## NEXT SESSION CONTEXT

**For future Claude instances**: This memory provides the strategic direction. When planning work:
1. Always prioritize production-readiness over new features
2. Check implementation gaps in "Critical Gaps" section
3. Align tasks with current strategic phase
4. Maintain quality standards defined above
5. Follow architectural patterns consistently

**Current Phase**: Phase 1 - Production Readiness
**Top Priority**: Replace mocked service integrations in EVV and Scheduling
